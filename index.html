<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>QUANTUM MANIFOLD - BIOMETRIC CORE v11.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Syncopate:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #00f3ff;
            --secondary: #ffffff;
            --bg: #02040a;
            --panel-bg: rgba(2, 6, 15, 0.4);
            --accent: #7000ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: var(--bg);
            overflow: hidden;
            font-family: 'Outfit', sans-serif;
            color: var(--secondary);
            user-select: none;
        }

        #ui-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            padding: 40px;
        }

        .side-panel {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .hud-block {
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(0, 243, 255, 0.3);
            padding: 24px;
            pointer-events: auto;
            transition: all 0.3s ease;
        }

        .hud-block:hover {
            border-left: 1px solid var(--primary);
            background: rgba(2, 6, 15, 0.6);
        }

        h1 {
            font-family: 'Syncopate', sans-serif;
            font-size: 14px;
            letter-spacing: 4px;
            color: var(--primary);
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 12px 0;
            font-size: 13px;
        }

        .stat-label {
            opacity: 0.6;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .stat-value {
            font-weight: 600;
            color: var(--primary);
        }

        .progress-container {
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.1s;
        }

        #control-panel {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            pointer-events: auto;
            z-index: 150;
        }

        .interactive-chip {
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            padding: 12px 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            cursor: pointer;
            font-size: 12px;
            letter-spacing: 2px;
            color: var(--secondary);
            transition: all 0.3s;
        }

        .interactive-chip:hover {
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
        }

        .interactive-chip.active {
            background: var(--primary);
            color: var(--bg);
            border-color: var(--primary);
        }

        #camera-feed {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 240px;
            height: 180px;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(0, 243, 255, 0.2);
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        #camera-feed:hover {
            opacity: 1;
            border-color: var(--primary);
        }

        canvas#scene-canvas {
            display: block;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #loader-text {
            font-family: 'Syncopate', sans-serif;
            font-size: 18px;
            letter-spacing: 12px;
            margin-bottom: 40px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.4;
            }
        }

        #permission-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: #0a0e1a;
            padding: 60px;
            border: 1px solid var(--primary);
            text-align: center;
            max-width: 600px;
        }

        .modal-content h2 {
            font-family: 'Syncopate';
            margin-bottom: 30px;
            letter-spacing: 4px;
        }

        .modal-content p {
            margin-bottom: 40px;
            opacity: 0.7;
            line-height: 1.8;
        }

        .btn-primary {
            background: var(--primary);
            border: none;
            padding: 16px 40px;
            font-family: 'Syncopate';
            font-size: 12px;
            cursor: pointer;
            margin: 0 10px;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: scale(1.05);
        }

        /* Scrollbar Hide */
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>

    <div id="loading-screen">
        <div id="loader-text">QUANTUM MANIFOLD</div>
        <div style="width: 200px; height: 1px; background: rgba(255,255,255,0.1);">
            <div id="loader-bar" style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s;">
            </div>
        </div>
    </div>

    <div id="permission-modal">
        <div class="modal-content">
            <h2>BIOMETRIC AUTHORIZATION</h2>
            <p>To initialize the Quantum Manifold, the system requires local biometric access. Your data remains on your
                device and is never transmitted.</p>
            <button class="btn-primary" onclick="requestAccess()">INITIALIZE SYSTEM</button>
        </div>
    </div>

    <div id="ui-wrapper">
        <div class="side-panel">
            <div class="hud-block">
                <h1>CORE SYSTEM</h1>
                <div class="stat-row">
                    <span class="stat-label">MANIFEST:</span>
                    <span class="stat-value">QUANTUM_FLUID_V11</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ENTROPY:</span>
                    <span class="stat-value" id="val-entropy">0.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">FLUX:</span>
                    <span class="stat-value" id="val-flux">INACTIVE</span>
                </div>
            </div>

            <div class="hud-block">
                <h1>BIOMETRICS</h1>
                <div class="stat-row">
                    <span class="stat-label">TRACKING:</span>
                    <span class="stat-value" id="val-tracking">OFF</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">PRESENCE:</span>
                    <span class="stat-value" id="val-presence">0%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="pb-presence"></div>
                </div>
            </div>
        </div>

        <div class="side-panel" style="align-items: flex-end;">
            <div class="hud-block">
                <h1>NETWORK STATUS</h1>
                <div class="stat-row">
                    <span class="stat-label">NEURONS:</span>
                    <span class="stat-value">120,000</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ENTANGLEMENT:</span>
                    <span class="stat-value" id="val-entanglement">84.2%</span>
                </div>
            </div>

            <div class="hud-block">
                <h1>AUDIO_FLOW</h1>
                <div class="stat-row">
                    <span class="stat-label">LEVEL:</span>
                    <span class="stat-value" id="val-audio">0 dB</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="pb-audio"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="control-panel">
        <div class="interactive-chip" id="btn-audio">AUDIO: DISABLED</div>
        <div class="interactive-chip" id="btn-camera">CAMERA: DISABLED</div>
        <div class="interactive-chip" onclick="resetView()">RESET_VIEW</div>
    </div>

    <div id="camera-feed">
        <canvas id="camera-canvas"></canvas>
    </div>

    <canvas id="scene-canvas"></canvas>

    <!-- Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection@2.0.0/dist/hand-pose-detection.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.min.js"></script>

    <!-- Custom Shaders -->
    <script id="crystalVertex" type="x-shader/x-vertex">
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            vNormal = normalize(normalMatrix * normal);
            vViewPosition = -mvPosition.xyz;
            gl_Position = projectionMatrix * mvPosition;
        }
    </script>
    <script id="crystalFragment" type="x-shader/x-fragment">
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        uniform vec3 color;
        uniform float time;
        void main() {
            float fresnel = pow(1.0 - dot(normalize(vNormal), normalize(vViewPosition)), 3.0);
            vec3 finalColor = mix(color * 0.2, color, fresnel);
            float pulse = sin(time * 2.0) * 0.1 + 0.9;
            gl_FragColor = vec4(finalColor * pulse, 0.8 * fresnel + 0.1);
        }
    </script>

    <script id="meshVertex" type="x-shader/x-vertex">
        uniform float time;
        uniform float audio;
        uniform vec3 gravityPoint;
        uniform float gravityStrength;
        varying float vAlpha;
        void main() {
            vec3 pos = position;
            
            // Audio ripple
            float dist = length(pos);
            float ripple = sin(dist * 0.05 - time * 5.0) * audio * 20.0;
            pos += normal * ripple;

            // Gravity interaction
            vec3 gravityDir = gravityPoint - pos;
            float gravityDist = length(gravityDir);
            if(gravityDist < 300.0) {
                pos += normalize(gravityDir) * (1.0 - gravityDist / 300.0) * gravityStrength * 50.0;
            }

            vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);
            vAlpha = clamp(1.0 - (length(pos) / 1000.0), 0.0, 1.0);
            gl_PointSize = (1000.0 / -mvPosition.z) * 1.5;
            gl_Position = projectionMatrix * mvPosition;
        }
    </script>

    <script id="meshFragment" type="x-shader/x-fragment">
        varying float vAlpha;
        uniform vec3 color;
        void main() {
            float dist = length(gl_PointCoord - vec2(0.5));
            if(dist > 0.5) discard;
            gl_FragColor = vec4(color, vAlpha * (1.0 - dist * 2.0));
        }
    </script>

    <script>
        const config = {
            meshPoints: 50000,
            color: new THREE.Color('#00f3ff'),
            gravityStrength: 0,
            audioLevel: 0,
            handPos: new THREE.Vector3(1000, 0, 0)
        };

        let scene, camera, renderer, composer, mesh, core;
        let handDetector, audioCtx, analyser;
        let clock = new THREE.Clock();

        function init() {
            setupThree();
            createQuantumMesh();
            createCrystalCore();
            setupPostProcessing();
            animate();

            setTimeout(() => {
                document.getElementById('permission-modal').style.display = 'flex';
                updateLoader(100);
            }, 1000);
        }

        function setupThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 5000);
            camera.position.set(0, 0, 800);

            renderer = new THREE.WebGLRenderer({
                canvas: document.getElementById('scene-canvas'),
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            const ambient = new THREE.AmbientLight(0xffffff, 0.1);
            scene.add(ambient);

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                composer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        function createQuantumMesh() {
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(config.meshPoints * 3);
            for (let i = 0; i < config.meshPoints * 3; i++) {
                pos[i] = (Math.random() - 0.5) * 1200;
            }
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));

            const mat = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    audio: { value: 0 },
                    color: { value: config.color },
                    gravityPoint: { value: config.handPos },
                    gravityStrength: { value: 0 }
                },
                vertexShader: document.getElementById('meshVertex').textContent,
                fragmentShader: document.getElementById('meshFragment').textContent,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });

            mesh = new THREE.Points(geo, mat);
            scene.add(mesh);
        }

        function createCrystalCore() {
            const geo = new THREE.IcosahedronGeometry(100, 1);
            const mat = new THREE.ShaderMaterial({
                uniforms: {
                    color: { value: config.color },
                    time: { value: 0 }
                },
                vertexShader: document.getElementById('crystalVertex').textContent,
                fragmentShader: document.getElementById('crystalFragment').textContent,
                transparent: true,
                side: THREE.BackSide
            });
            core = new THREE.Mesh(geo, mat);
            scene.add(core);

            const innerGeo = new THREE.IcosahedronGeometry(70, 0);
            const innerMat = new THREE.MeshBasicMaterial({ color: config.color, wireframe: true, transparent: true, opacity: 0.2 });
            core.add(new THREE.Mesh(innerGeo, innerMat));
        }

        function setupPostProcessing() {
            composer = new THREE.EffectComposer(renderer);
            composer.addPass(new THREE.RenderPass(scene, camera));

            const bloom = new THREE.UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                1.5, 0.4, 0.85
            );
            bloom.threshold = 0.1;
            bloom.strength = 1.0;
            bloom.radius = 0.5;
            composer.addPass(bloom);
        }

        async function requestAccess() {
            document.getElementById('permission-modal').style.display = 'none';
            document.getElementById('loading-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 500);

            await initAudio();
            await initCamera();
        }

        async function initAudio() {
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const source = audioCtx.createMediaStreamSource(stream);
                analyser = audioCtx.createAnalyser();
                source.connect(analyser);
                document.getElementById('btn-audio').textContent = "AUDIO: ACTIVE";
                document.getElementById('btn-audio').classList.add('active');
            } catch (e) { console.error(e); }
        }

        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 320, height: 240 } });
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                const model = handPoseDetection.SupportedModels.MediaPipeHands;
                handDetector = await handPoseDetection.createDetector(model, {
                    runtime: 'mediapipe',
                    solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4'
                });

                document.getElementById('btn-camera').textContent = "CAMERA: ACTIVE";
                document.getElementById('btn-camera').classList.add('active');
                document.getElementById('val-tracking').textContent = "BIOMETRIC";

                trackHand(video);
            } catch (e) { console.error(e); }
        }

        async function trackHand(video) {
            const hands = await handDetector.estimateHands(video);
            if (hands.length > 0) {
                const hand = hands[0];
                const keypoint = hand.keypoints[9]; // Middle MCP
                config.handPos.x = (keypoint.x / 320 - 0.5) * 1000;
                config.handPos.y = (0.5 - keypoint.y / 240) * 1000;
                config.handPos.z = 200;
                config.gravityStrength = 1.5;
                document.getElementById('val-presence').textContent = "100%";
                document.getElementById('pb-presence').style.width = "100%";
            } else {
                config.gravityStrength = 0;
                document.getElementById('val-presence').textContent = "0%";
                document.getElementById('pb-presence').style.width = "0%";
            }
            requestAnimationFrame(() => trackHand(video));
        }

        function updateLoader(val) {
            document.getElementById('loader-bar').style.width = val + '%';
        }

        function resetView() {
            camera.position.set(0, 0, 800);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            if (analyser) {
                const data = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(data);
                let avg = data.reduce((a, b) => a + b) / data.length;
                config.audioLevel = avg / 255;
                document.getElementById('val-audio').textContent = Math.round(avg) + " unit";
                document.getElementById('pb-audio').style.width = (avg / 128 * 100) + "%";
            }

            mesh.material.uniforms.time.value = time;
            mesh.material.uniforms.audio.value = config.audioLevel;
            mesh.material.uniforms.gravityStrength.value = config.gravityStrength;
            mesh.material.uniforms.gravityPoint.value.copy(config.handPos);

            core.material.uniforms.time.value = time;
            core.rotation.y += 0.005 + config.audioLevel * 0.05;
            core.rotation.z += 0.003;

            document.getElementById('val-entropy').textContent = (Math.sin(time) * 0.1 + 0.8).toFixed(4);

            composer.render();
        }

        init();
    </script>
</body>

</html>